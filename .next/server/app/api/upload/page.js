(()=>{var e={};e.id=303,e.ids=[303],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},5511:e=>{"use strict";e.exports=require("crypto")},1994:e=>{"use strict";e.exports=require("domain")},9021:e=>{"use strict";e.exports=require("fs")},1820:e=>{"use strict";e.exports=require("os")},3873:e=>{"use strict";e.exports=require("path")},1039:(e,t,n)=>{"use strict";n.r(t),n.d(t,{GlobalError:()=>o.a,__next_app__:()=>c,pages:()=>d,routeModule:()=>u,tree:()=>h});var i=n(260),s=n(8203),r=n(5155),o=n.n(r),a=n(7292),l={};for(let e in a)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>a[e]);n.d(t,l);let h=["",{children:["api",{children:["upload",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(n.bind(n,7717)),"/Users/shamitsurana/Stanford CS Classes/Treehacks/nextgen-firewatcher/src/app/api/upload/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(n.bind(n,1354)),"/Users/shamitsurana/Stanford CS Classes/Treehacks/nextgen-firewatcher/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(n.t.bind(n,9937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(n.t.bind(n,9116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(n.t.bind(n,1485,23)),"next/dist/client/components/unauthorized-error"]}],d=["/Users/shamitsurana/Stanford CS Classes/Treehacks/nextgen-firewatcher/src/app/api/upload/page.tsx"],c={require:n,loadChunk:()=>Promise.resolve()},u=new i.AppPageRouteModule({definition:{kind:s.RouteKind.APP_PAGE,page:"/api/upload/page",pathname:"/api/upload",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:h}})},7331:(e,t,n)=>{Promise.resolve().then(n.bind(n,6832)),Promise.resolve().then(n.bind(n,617)),Promise.resolve().then(n.bind(n,6722)),Promise.resolve().then(n.bind(n,2183)),Promise.resolve().then(n.bind(n,3679)),Promise.resolve().then(n.bind(n,955)),Promise.resolve().then(n.bind(n,9364)),Promise.resolve().then(n.bind(n,7779)),Promise.resolve().then(n.bind(n,4651)),Promise.resolve().then(n.bind(n,7143)),Promise.resolve().then(n.bind(n,6803)),Promise.resolve().then(n.bind(n,3071)),Promise.resolve().then(n.bind(n,7091))},4283:(e,t,n)=>{Promise.resolve().then(n.bind(n,3503)),Promise.resolve().then(n.bind(n,7641)),Promise.resolve().then(n.bind(n,4186)),Promise.resolve().then(n.bind(n,6671)),Promise.resolve().then(n.bind(n,8951)),Promise.resolve().then(n.bind(n,8515)),Promise.resolve().then(n.bind(n,4517)),Promise.resolve().then(n.bind(n,1035)),Promise.resolve().then(n.bind(n,8378)),Promise.resolve().then(n.bind(n,5599)),Promise.resolve().then(n.bind(n,5003)),Promise.resolve().then(n.bind(n,999)),Promise.resolve().then(n.bind(n,7627))},5281:(e,t,n)=>{Promise.resolve().then(n.t.bind(n,3219,23)),Promise.resolve().then(n.t.bind(n,4863,23)),Promise.resolve().then(n.t.bind(n,5155,23)),Promise.resolve().then(n.t.bind(n,802,23)),Promise.resolve().then(n.t.bind(n,9350,23)),Promise.resolve().then(n.t.bind(n,8530,23)),Promise.resolve().then(n.t.bind(n,8921,23))},1729:(e,t,n)=>{Promise.resolve().then(n.t.bind(n,6959,23)),Promise.resolve().then(n.t.bind(n,3875,23)),Promise.resolve().then(n.t.bind(n,8903,23)),Promise.resolve().then(n.t.bind(n,7174,23)),Promise.resolve().then(n.t.bind(n,4178,23)),Promise.resolve().then(n.t.bind(n,7190,23)),Promise.resolve().then(n.t.bind(n,1365,23))},6487:()=>{},8335:()=>{},4531:(e,t,n)=>{"use strict";var i=n(8914),s=[];function r(){this.task=null,this.domain=null}e.exports=function(e){var t;(t=s.length?s.pop():new r).task=e,t.domain=process.domain,i(t)},r.prototype.call=function(){this.domain&&this.domain.enter();var e=!0;try{this.task.call(),e=!1,this.domain&&this.domain.exit()}finally{e&&i.requestFlush(),this.task=null,this.domain=null,s.push(this)}}},8914:(e,t,n)=>{"use strict";var i,s="function"==typeof setImmediate;function r(e){o.length||(d(),a=!0),o[o.length]=e}e.exports=r;var o=[],a=!1,l=0;function h(){for(;l<o.length;){var e=l;if(l+=1,o[e].call(),l>1024){for(var t=0,n=o.length-l;t<n;t++)o[t]=o[t+l];o.length-=l,l=0}}o.length=0,l=0,a=!1}function d(){var e=process.domain;e&&(i||(i=n(1994)),i.active=process.domain=null),a&&s?setImmediate(h):process.nextTick(h),e&&(i.active=process.domain=e)}r.requestFlush=d},9819:(e,t,n)=>{var i=n(2188);e.exports=i(function(e){var t=!0;return s(function(){t=!1}),function(){var n=arguments,i=this;t?s(function(){e.apply(i,n)}):e.apply(i,n)}});var s=n(4531)},5482:(e,t,n)=>{let i=n(9021),s=n(3873),r=n(1820),o=n(5511),a=n(7336).version,l=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/mg;function h(e){console.log(`[dotenv@${a}][DEBUG] ${e}`)}function d(e){return e&&e.DOTENV_KEY&&e.DOTENV_KEY.length>0?e.DOTENV_KEY:process.env.DOTENV_KEY&&process.env.DOTENV_KEY.length>0?process.env.DOTENV_KEY:""}function c(e){let t=null;if(e&&e.path&&e.path.length>0){if(Array.isArray(e.path))for(let n of e.path)i.existsSync(n)&&(t=n.endsWith(".vault")?n:`${n}.vault`);else t=e.path.endsWith(".vault")?e.path:`${e.path}.vault`}else t=s.resolve(process.cwd(),".env.vault");return i.existsSync(t)?t:null}function u(e){return"~"===e[0]?s.join(r.homedir(),e.slice(1)):e}let f={configDotenv:function(e){let t;let n=s.resolve(process.cwd(),".env"),r="utf8",o=!!(e&&e.debug);e&&e.encoding?r=e.encoding:o&&h("No encoding is specified. UTF-8 is used by default");let a=[n];if(e&&e.path){if(Array.isArray(e.path))for(let t of(a=[],e.path))a.push(u(t));else a=[u(e.path)]}let l={};for(let n of a)try{let t=f.parse(i.readFileSync(n,{encoding:r}));f.populate(l,t,e)}catch(e){o&&h(`Failed to load ${n} ${e.message}`),t=e}let d=process.env;return(e&&null!=e.processEnv&&(d=e.processEnv),f.populate(d,l,e),t)?{parsed:l,error:t}:{parsed:l}},_configVault:function(e){console.log(`[dotenv@${a}][INFO] Loading env from encrypted .env.vault`);let t=f._parseVault(e),n=process.env;return e&&null!=e.processEnv&&(n=e.processEnv),f.populate(n,t,e),{parsed:t}},_parseVault:function(e){let t;let n=c(e),i=f.configDotenv({path:n});if(!i.parsed){let e=Error(`MISSING_DATA: Cannot parse ${n} for an unknown reason`);throw e.code="MISSING_DATA",e}let s=d(e).split(","),r=s.length;for(let e=0;e<r;e++)try{let n=s[e].trim(),r=function(e,t){let n;try{n=new URL(t)}catch(e){if("ERR_INVALID_URL"===e.code){let e=Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development");throw e.code="INVALID_DOTENV_KEY",e}throw e}let i=n.password;if(!i){let e=Error("INVALID_DOTENV_KEY: Missing key part");throw e.code="INVALID_DOTENV_KEY",e}let s=n.searchParams.get("environment");if(!s){let e=Error("INVALID_DOTENV_KEY: Missing environment part");throw e.code="INVALID_DOTENV_KEY",e}let r=`DOTENV_VAULT_${s.toUpperCase()}`,o=e.parsed[r];if(!o){let e=Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${r} in your .env.vault file.`);throw e.code="NOT_FOUND_DOTENV_ENVIRONMENT",e}return{ciphertext:o,key:i}}(i,n);t=f.decrypt(r.ciphertext,r.key);break}catch(t){if(e+1>=r)throw t}return f.parse(t)},config:function(e){if(0===d(e).length)return f.configDotenv(e);let t=c(e);if(!t){var n;return n=`You set DOTENV_KEY but you are missing a .env.vault file at ${t}. Did you forget to build it?`,console.log(`[dotenv@${a}][WARN] ${n}`),f.configDotenv(e)}return f._configVault(e)},decrypt:function(e,t){let n=Buffer.from(t.slice(-64),"hex"),i=Buffer.from(e,"base64"),s=i.subarray(0,12),r=i.subarray(-16);i=i.subarray(12,-16);try{let e=o.createDecipheriv("aes-256-gcm",n,s);return e.setAuthTag(r),`${e.update(i)}${e.final()}`}catch(i){let e=i instanceof RangeError,t="Invalid key length"===i.message,n="Unsupported state or unable to authenticate data"===i.message;if(e||t){let e=Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");throw e.code="INVALID_DOTENV_KEY",e}if(n){let e=Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw e.code="DECRYPTION_FAILED",e}throw i}},parse:function(e){let t;let n={},i=e.toString();for(i=i.replace(/\r\n?/mg,"\n");null!=(t=l.exec(i));){let e=t[1],i=t[2]||"",s=(i=i.trim())[0];i=i.replace(/^(['"`])([\s\S]*)\1$/mg,"$2"),'"'===s&&(i=(i=i.replace(/\\n/g,"\n")).replace(/\\r/g,"\r")),n[e]=i}return n},populate:function(e,t,n={}){let i=!!(n&&n.debug),s=!!(n&&n.override);if("object"!=typeof t){let e=Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");throw e.code="OBJECT_REQUIRED",e}for(let n of Object.keys(t))Object.prototype.hasOwnProperty.call(e,n)?(!0===s&&(e[n]=t[n]),i&&(!0===s?h(`"${n}" is already defined and WAS overwritten`):h(`"${n}" is already defined and was NOT overwritten`))):e[n]=t[n]}};e.exports.configDotenv=f.configDotenv,e.exports._configVault=f._configVault,e.exports._parseVault=f._parseVault,e.exports.config=f.config,e.exports.decrypt=f.decrypt,e.exports.parse=f.parse,e.exports.populate=f.populate,e.exports=f},9867:(e,t,n)=>{var i=n(2188);function s(e){var t=function(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}function r(e){var t=function(){if(t.called)throw Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)},n=e.name||"Function wrapped with `once`";return t.onceError=n+" shouldn't be called more than once",t.called=!1,t}e.exports=i(s),e.exports.strict=i(r),s.proto=s(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return s(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return r(this)},configurable:!0})})},2188:e=>{e.exports=function e(t,n){if(t&&n)return e(t)(n);if("function"!=typeof t)throw TypeError("need wrapper function");return Object.keys(t).forEach(function(e){i[e]=t[e]}),i;function i(){for(var e=Array(arguments.length),n=0;n<e.length;n++)e[n]=arguments[n];var i=t.apply(this,e),s=e[e.length-1];return"function"==typeof i&&i!==s&&Object.keys(s).forEach(function(e){i[e]=s[e]}),i}}},7717:(e,t,n)=>{"use strict";n.r(t),n.d(t,{config:()=>eU,default:()=>ek}),function(e){e.STRING="string",e.NUMBER="number",e.INTEGER="integer",e.BOOLEAN="boolean",e.ARRAY="array",e.OBJECT="object"}(q||(q={})),function(e){e.LANGUAGE_UNSPECIFIED="language_unspecified",e.PYTHON="python"}(G||(G={})),function(e){e.OUTCOME_UNSPECIFIED="outcome_unspecified",e.OUTCOME_OK="outcome_ok",e.OUTCOME_FAILED="outcome_failed",e.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"}(K||(K={}));let i=["user","model","function","system"];(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"})(z||(z={})),function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"}(W||(W={})),function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"}(J||(J={})),function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"}(X||(X={})),function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.OTHER="OTHER"}(Q||(Q={})),function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"}(Z||(Z={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"}(ee||(ee={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"}(et||(et={}));class s extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class r extends s{constructor(e,t){super(e),this.response=t}}class o extends s{constructor(e,t,n,i){super(e),this.status=t,this.statusText=n,this.errorDetails=i}}class a extends s{}!function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"}(en||(en={}));class l{constructor(e,t,n,i,s){this.model=e,this.task=t,this.apiKey=n,this.stream=i,this.requestOptions=s}toString(){var e,t;let n=(null===(e=this.requestOptions)||void 0===e?void 0:e.apiVersion)||"v1beta",i=(null===(t=this.requestOptions)||void 0===t?void 0:t.baseUrl)||"https://generativelanguage.googleapis.com",s=`${i}/${n}/${this.model}:${this.task}`;return this.stream&&(s+="?alt=sse"),s}}async function h(e){var t;let n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",function(e){let t=[];return(null==e?void 0:e.apiClient)&&t.push(e.apiClient),t.push("genai-js/0.21.0"),t.join(" ")}(e.requestOptions)),n.append("x-goog-api-key",e.apiKey);let i=null===(t=e.requestOptions)||void 0===t?void 0:t.customHeaders;if(i){if(!(i instanceof Headers))try{i=new Headers(i)}catch(e){throw new a(`unable to convert customHeaders value ${JSON.stringify(i)} to Headers: ${e.message}`)}for(let[e,t]of i.entries()){if("x-goog-api-key"===e)throw new a(`Cannot set reserved header name ${e}`);if("x-goog-api-client"===e)throw new a(`Header name ${e} can only be set using the apiClient field`);n.append(e,t)}}return n}async function d(e,t,n,i,s,r){let o=new l(e,t,n,i,r);return{url:o.toString(),fetchOptions:Object.assign(Object.assign({},function(e){let t={};if((null==e?void 0:e.signal)!==void 0||(null==e?void 0:e.timeout)>=0){let n=new AbortController;(null==e?void 0:e.timeout)>=0&&setTimeout(()=>n.abort(),e.timeout),(null==e?void 0:e.signal)&&e.signal.addEventListener("abort",()=>{n.abort()}),t.signal=n.signal}return t}(r)),{method:"POST",headers:await h(o),body:s})}}async function c(e,t,n,i,s,r={},o=fetch){let{url:a,fetchOptions:l}=await d(e,t,n,i,s,r);return u(a,l,o)}async function u(e,t,n=fetch){let i;try{i=await n(e,t)}catch(t){(function(e,t){let n=e;throw e instanceof o||e instanceof a||((n=new s(`Error fetching from ${t.toString()}: ${e.message}`)).stack=e.stack),n})(t,e)}return i.ok||await f(i,e),i}async function f(e,t){let n,i="";try{let t=await e.json();i=t.error.message,t.error.details&&(i+=` ${JSON.stringify(t.error.details)}`,n=t.error.details)}catch(e){}throw new o(`Error fetching from ${t.toString()}: [${e.status} ${e.statusText}] ${i}`,e.status,e.statusText,n)}function p(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),E(e.candidates[0]))throw new r(`${_(e)}`,e);return function(e){var t,n,i,s;let r=[];if(null===(n=null===(t=e.candidates)||void 0===t?void 0:t[0].content)||void 0===n?void 0:n.parts)for(let t of null===(s=null===(i=e.candidates)||void 0===i?void 0:i[0].content)||void 0===s?void 0:s.parts)t.text&&r.push(t.text),t.executableCode&&r.push("\n```"+t.executableCode.language+"\n"+t.executableCode.code+"\n```\n"),t.codeExecutionResult&&r.push("\n```\n"+t.codeExecutionResult.output+"\n```\n");return r.length>0?r.join(""):""}(e)}if(e.promptFeedback)throw new r(`Text not available. ${_(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),E(e.candidates[0]))throw new r(`${_(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),m(e)[0]}if(e.promptFeedback)throw new r(`Function call not available. ${_(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),E(e.candidates[0]))throw new r(`${_(e)}`,e);return m(e)}if(e.promptFeedback)throw new r(`Function call not available. ${_(e)}`,e)},e}function m(e){var t,n,i,s;let r=[];if(null===(n=null===(t=e.candidates)||void 0===t?void 0:t[0].content)||void 0===n?void 0:n.parts)for(let t of null===(s=null===(i=e.candidates)||void 0===i?void 0:i[0].content)||void 0===s?void 0:s.parts)t.functionCall&&r.push(t.functionCall);return r.length>0?r:void 0}let g=[Q.RECITATION,Q.SAFETY,Q.LANGUAGE];function E(e){return!!e.finishReason&&g.includes(e.finishReason)}function _(e){var t,n,i;let s="";if((!e.candidates||0===e.candidates.length)&&e.promptFeedback)s+="Response was blocked",(null===(t=e.promptFeedback)||void 0===t?void 0:t.blockReason)&&(s+=` due to ${e.promptFeedback.blockReason}`),(null===(n=e.promptFeedback)||void 0===n?void 0:n.blockReasonMessage)&&(s+=`: ${e.promptFeedback.blockReasonMessage}`);else if(null===(i=e.candidates)||void 0===i?void 0:i[0]){let t=e.candidates[0];E(t)&&(s+=`Candidate was blocked due to ${t.finishReason}`,t.finishMessage&&(s+=`: ${t.finishMessage}`))}return s}function y(e){return this instanceof y?(this.v=e,this):new y(e)}"function"==typeof SuppressedError&&SuppressedError;let b=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;async function v(e){let t=[],n=e.getReader();for(;;){let{done:e,value:i}=await n.read();if(e)return p(function(e){let t=e[e.length-1],n={promptFeedback:null==t?void 0:t.promptFeedback};for(let t of e){if(t.candidates)for(let e of t.candidates){let t=e.index;if(n.candidates||(n.candidates=[]),n.candidates[t]||(n.candidates[t]={index:e.index}),n.candidates[t].citationMetadata=e.citationMetadata,n.candidates[t].groundingMetadata=e.groundingMetadata,n.candidates[t].finishReason=e.finishReason,n.candidates[t].finishMessage=e.finishMessage,n.candidates[t].safetyRatings=e.safetyRatings,e.content&&e.content.parts){n.candidates[t].content||(n.candidates[t].content={role:e.content.role||"user",parts:[]});let i={};for(let s of e.content.parts)s.text&&(i.text=s.text),s.functionCall&&(i.functionCall=s.functionCall),s.executableCode&&(i.executableCode=s.executableCode),s.codeExecutionResult&&(i.codeExecutionResult=s.codeExecutionResult),0===Object.keys(i).length&&(i.text=""),n.candidates[t].content.parts.push(i)}}t.usageMetadata&&(n.usageMetadata=t.usageMetadata)}return n}(t));t.push(i)}}async function O(e,t,n,i){return function(e){let[t,n]=(function(e){let t=e.getReader();return new ReadableStream({start(e){let n="";return function i(){return t.read().then(({value:t,done:r})=>{let o;if(r){if(n.trim()){e.error(new s("Failed to parse stream"));return}e.close();return}let a=(n+=t).match(b);for(;a;){try{o=JSON.parse(a[1])}catch(t){e.error(new s(`Error parsing JSON response: "${a[1]}"`));return}e.enqueue(o),a=(n=n.substring(a[0].length)).match(b)}return i()})}()}})})(e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0}))).tee();return{stream:function(e){return function(e,t,n){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var i,s=n.apply(e,t||[]),r=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(e){s[e]&&(i[e]=function(t){return new Promise(function(n,i){r.push([e,t,n,i])>1||a(e,t)})})}function a(e,t){try{var n;(n=s[e](t)).value instanceof y?Promise.resolve(n.value.v).then(l,h):d(r[0][2],n)}catch(e){d(r[0][3],e)}}function l(e){a("next",e)}function h(e){a("throw",e)}function d(e,t){e(t),r.shift(),r.length&&a(r[0][0],r[0][1])}}(this,arguments,function*(){let t=e.getReader();for(;;){let{value:e,done:n}=yield y(t.read());if(n)break;yield yield y(p(e))}})}(t),response:v(n)}}(await c(t,en.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(n),i))}async function A(e,t,n,i){let s=await c(t,en.GENERATE_CONTENT,e,!1,JSON.stringify(n),i);return{response:p(await s.json())}}function T(e){if(null!=e){if("string"==typeof e)return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)return e.role?e:{role:"system",parts:e.parts}}}function w(e){let t=[];if("string"==typeof e)t=[{text:e}];else for(let n of e)"string"==typeof n?t.push({text:n}):t.push(n);return function(e){let t={role:"user",parts:[]},n={role:"function",parts:[]},i=!1,r=!1;for(let s of e)"functionResponse"in s?(n.parts.push(s),r=!0):(t.parts.push(s),i=!0);if(i&&r)throw new s("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!i&&!r)throw new s("No content is provided for sending chat message.");return i?t:n}(t)}function C(e){let t;return t=e.contents?e:{contents:[w(e)]},e.systemInstruction&&(t.systemInstruction=T(e.systemInstruction)),t}let S=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],N={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]},D="SILENT_ERROR";class x{constructor(e,t,n,r={}){this.model=t,this.params=n,this._requestOptions=r,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,(null==n?void 0:n.history)&&(function(e){let t=!1;for(let n of e){let{role:e,parts:r}=n;if(!t&&"user"!==e)throw new s(`First content should be with role 'user', got ${e}`);if(!i.includes(e))throw new s(`Each item should include role field. Got ${e} but valid roles are: ${JSON.stringify(i)}`);if(!Array.isArray(r))throw new s("Content should have 'parts' property with an array of Parts");if(0===r.length)throw new s("Each Content should have at least one part");let o={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let e of r)for(let t of S)t in e&&(o[t]+=1);let a=N[e];for(let t of S)if(!a.includes(t)&&o[t]>0)throw new s(`Content with role '${e}' can't contain '${t}' part`);t=!0}}(n.history),this._history=n.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var n,i,s,r,o,a;let l;await this._sendPromise;let h=w(e),d={safetySettings:null===(n=this.params)||void 0===n?void 0:n.safetySettings,generationConfig:null===(i=this.params)||void 0===i?void 0:i.generationConfig,tools:null===(s=this.params)||void 0===s?void 0:s.tools,toolConfig:null===(r=this.params)||void 0===r?void 0:r.toolConfig,systemInstruction:null===(o=this.params)||void 0===o?void 0:o.systemInstruction,cachedContent:null===(a=this.params)||void 0===a?void 0:a.cachedContent,contents:[...this._history,h]},c=Object.assign(Object.assign({},this._requestOptions),t);return this._sendPromise=this._sendPromise.then(()=>A(this._apiKey,this.model,d,c)).then(e=>{var t;if(e.response.candidates&&e.response.candidates.length>0){this._history.push(h);let n=Object.assign({parts:[],role:"model"},null===(t=e.response.candidates)||void 0===t?void 0:t[0].content);this._history.push(n)}else{let t=_(e.response);t&&console.warn(`sendMessage() was unsuccessful. ${t}. Inspect response object for details.`)}l=e}),await this._sendPromise,l}async sendMessageStream(e,t={}){var n,i,s,r,o,a;await this._sendPromise;let l=w(e),h={safetySettings:null===(n=this.params)||void 0===n?void 0:n.safetySettings,generationConfig:null===(i=this.params)||void 0===i?void 0:i.generationConfig,tools:null===(s=this.params)||void 0===s?void 0:s.tools,toolConfig:null===(r=this.params)||void 0===r?void 0:r.toolConfig,systemInstruction:null===(o=this.params)||void 0===o?void 0:o.systemInstruction,cachedContent:null===(a=this.params)||void 0===a?void 0:a.cachedContent,contents:[...this._history,l]},d=Object.assign(Object.assign({},this._requestOptions),t),c=O(this._apiKey,this.model,h,d);return this._sendPromise=this._sendPromise.then(()=>c).catch(e=>{throw Error(D)}).then(e=>e.response).then(e=>{if(e.candidates&&e.candidates.length>0){this._history.push(l);let t=Object.assign({},e.candidates[0].content);t.role||(t.role="model"),this._history.push(t)}else{let t=_(e);t&&console.warn(`sendMessageStream() was unsuccessful. ${t}. Inspect response object for details.`)}}).catch(e=>{e.message!==D&&console.error(e)}),c}}async function R(e,t,n,i){return(await c(t,en.COUNT_TOKENS,e,!1,JSON.stringify(n),i)).json()}async function I(e,t,n,i){return(await c(t,en.EMBED_CONTENT,e,!1,JSON.stringify(n),i)).json()}async function F(e,t,n,i){let s=n.requests.map(e=>Object.assign(Object.assign({},e),{model:t}));return(await c(t,en.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:s}),i)).json()}class P{constructor(e,t,n={}){this.apiKey=e,this._requestOptions=n,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=T(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var n;let i=C(e),s=Object.assign(Object.assign({},this._requestOptions),t);return A(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(n=this.cachedContent)||void 0===n?void 0:n.name},i),s)}async generateContentStream(e,t={}){var n;let i=C(e),s=Object.assign(Object.assign({},this._requestOptions),t);return O(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(n=this.cachedContent)||void 0===n?void 0:n.name},i),s)}startChat(e){var t;return new x(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(t=this.cachedContent)||void 0===t?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){let n=function(e,t){var n;let i={model:null==t?void 0:t.model,generationConfig:null==t?void 0:t.generationConfig,safetySettings:null==t?void 0:t.safetySettings,tools:null==t?void 0:t.tools,toolConfig:null==t?void 0:t.toolConfig,systemInstruction:null==t?void 0:t.systemInstruction,cachedContent:null===(n=null==t?void 0:t.cachedContent)||void 0===n?void 0:n.name,contents:[]},s=null!=e.generateContentRequest;if(e.contents){if(s)throw new a("CountTokensRequest must have one of contents or generateContentRequest, not both.");i.contents=e.contents}else if(s)i=Object.assign(Object.assign({},i),e.generateContentRequest);else{let t=w(e);i.contents=[t]}return{generateContentRequest:i}}(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),i=Object.assign(Object.assign({},this._requestOptions),t);return R(this.apiKey,this.model,n,i)}async embedContent(e,t={}){let n="string"==typeof e||Array.isArray(e)?{content:w(e)}:e,i=Object.assign(Object.assign({},this._requestOptions),t);return I(this.apiKey,this.model,n,i)}async batchEmbedContents(e,t={}){let n=Object.assign(Object.assign({},this._requestOptions),t);return F(this.apiKey,this.model,e,n)}}class L{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new s("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new P(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,n){if(!e.name)throw new a("Cached content must contain a `name` field.");if(!e.model)throw new a("Cached content must contain a `model` field.");for(let n of["model","systemInstruction"])if((null==t?void 0:t[n])&&e[n]&&(null==t?void 0:t[n])!==e[n]){if("model"===n&&(t.model.startsWith("models/")?t.model.replace("models/",""):t.model)===(e.model.startsWith("models/")?e.model.replace("models/",""):e.model))continue;throw new a(`Different value for "${n}" specified in modelParams (${t[n]}) and cachedContent (${e[n]})`)}let i=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new P(this.apiKey,i,n)}}let U=require("node:fs"),M=require("node:crypto"),k=require("node:events");class j extends k.EventEmitter{constructor({filepath:e,newFilename:t,originalFilename:n,mimetype:i,hashAlgorithm:s}){super(),this.lastModifiedDate=null,Object.assign(this,{filepath:e,newFilename:t,originalFilename:n,mimetype:i,hashAlgorithm:s}),this.size=0,this._writeStream=null,"string"==typeof this.hashAlgorithm?this.hash=M.createHash(this.hashAlgorithm):this.hash=null}open(){this._writeStream=U.createWriteStream(this.filepath),this._writeStream.on("error",e=>{this.emit("error",e)})}toJSON(){let e={size:this.size,filepath:this.filepath,newFilename:this.newFilename,mimetype:this.mimetype,mtime:this.lastModifiedDate,length:this.length,originalFilename:this.originalFilename};return this.hash&&""!==this.hash&&(e.hash=this.hash),e}toString(){return`PersistentFile: ${this.newFilename}, Original: ${this.originalFilename}, Path: ${this.filepath}`}write(e,t){if(this.hash&&this.hash.update(e),this._writeStream.closed){t();return}this._writeStream.write(e,()=>{this.lastModifiedDate=new Date,this.size+=e.length,this.emit("progress",this.size),t()})}end(e){this.hash&&(this.hash=this.hash.digest("hex")),this._writeStream.end(()=>{this.emit("end"),e()})}destroy(){this._writeStream.destroy();let e=this.filepath;setTimeout(function(){U.unlink(e,()=>{})},1)}}class $ extends k.EventEmitter{constructor({filepath:e,newFilename:t,originalFilename:n,mimetype:i,hashAlgorithm:s,createFileWriteStream:r}){super(),this.lastModifiedDate=null,Object.assign(this,{filepath:e,newFilename:t,originalFilename:n,mimetype:i,hashAlgorithm:s,createFileWriteStream:r}),this.size=0,this._writeStream=null,"string"==typeof this.hashAlgorithm?this.hash=(0,M.createHash)(this.hashAlgorithm):this.hash=null}open(){this._writeStream=this.createFileWriteStream(this),this._writeStream.on("error",e=>{this.emit("error",e)})}destroy(){this._writeStream.destroy()}toJSON(){let e={size:this.size,newFilename:this.newFilename,length:this.length,originalFilename:this.originalFilename,mimetype:this.mimetype};return this.hash&&""!==this.hash&&(e.hash=this.hash),e}toString(){return`VolatileFile: ${this.originalFilename}`}write(e,t){if(this.hash&&this.hash.update(e),this._writeStream.closed||this._writeStream.destroyed){t();return}this._writeStream.write(e,()=>{this.size+=e.length,this.emit("progress",this.size),t()})}end(e){this.hash&&(this.hash=this.hash.digest("hex")),this._writeStream.end(()=>{this.emit("end"),e()})}}let H=require("node:os"),B=require("node:path"),Y=require("node:fs/promises"),V=require("node:string_decoder");for(var q,G,K,z,W,J,X,Q,Z,ee,et,en,ei=256,es=[];ei--;)es[ei]=(ei+256).toString(16).substring(1);var er=n(9867),eo=n(9819);let ea=require("node:stream");class el extends ea.PassThrough{constructor(e={}){super(),this.globalOptions={...e}}}async function eh(e,t){let n=this||e;return/octet-stream/i.test(n.headers["content-type"])&&await ed.call(n,n,t),n}async function ed(e,t){this.type="octet-stream";let n=this.headers["x-file-name"],i=this.headers["content-type"],s=this._getNewName({originalFilename:n,mimetype:i}),r=this._joinDirectoryName(s),o=await this._newFile({newFilename:s,filepath:r,originalFilename:n,mimetype:i});this.emit("fileBegin",n,o),o.open(),this.openedFiles.push(o),this._flushing+=1,this._parser=new el(this.options);let a=0;return this._parser.on("data",e=>{this.pause(),a+=1,o.write(e,()=>{a-=1,this.resume(),this.ended&&this._parser.emit("doneWritingFile")})}),this._parser.on("end",()=>{this._flushing-=1,this.ended=!0;let e=()=>{o.end(()=>{this.emit("file","file",o),this._maybeEnd()})};0===a?e():this._parser.once("doneWritingFile",e)}),this}class ec extends ea.Transform{constructor(e={}){super({readableObjectMode:!0}),this.globalOptions={...e},this.buffer="",this.bufferLength=0}_transform(e,t,n){this.buffer+=e.toString("ascii"),this.bufferLength=this.buffer.length,n()}_flush(e){for(let[e,t]of new URLSearchParams(this.buffer))this.push({key:e,value:t});this.buffer="",e()}}function eu(e,t){this.type="urlencoded";let n=new ec(this.options);return n.on("data",({key:e,value:t})=>{this.emit("field",e,t)}),n.once("end",()=>{this.ended=!0,this._maybeEnd()}),this._parser=n,this}let ef=class extends Error{constructor(e,t,n=500){super(e),this.code=t,this.httpCode=n}},ep=0,em={PARSER_UNINITIALIZED:ep++,START:ep++,START_BOUNDARY:ep++,HEADER_FIELD_START:ep++,HEADER_FIELD:ep++,HEADER_VALUE_START:ep++,HEADER_VALUE:ep++,HEADER_VALUE_ALMOST_DONE:ep++,HEADERS_ALMOST_DONE:ep++,PART_DATA_START:ep++,PART_DATA:ep++,PART_END:ep++,END:ep++},eg={PART_BOUNDARY:1,LAST_BOUNDARY:2},eE={};Object.keys(em).forEach(e=>{eE[e]=em[e]});class e_ extends ea.Transform{constructor(e={}){super({readableObjectMode:!0}),this.boundary=null,this.boundaryChars=null,this.lookbehind=null,this.bufferLength=0,this.state=em.PARSER_UNINITIALIZED,this.globalOptions={...e},this.index=null,this.flags=0}_endUnexpected(){return new ef(`MultipartParser.end(): stream ended unexpectedly: ${this.explain()}`,1012,400)}_flush(e){this.state===em.HEADER_FIELD_START&&0===this.index||this.state===em.PART_DATA&&this.index===this.boundary.length?(this._handleCallback("partEnd"),this._handleCallback("end"),e()):this.state!==em.END?e(this._endUnexpected()):e()}initWithBoundary(e){this.boundary=Buffer.from(`\r
--${e}`),this.lookbehind=Buffer.alloc(this.boundary.length+8),this.state=em.START,this.boundaryChars={};for(let e=0;e<this.boundary.length;e++)this.boundaryChars[this.boundary[e]]=!0}_handleCallback(e,t,n,i){(void 0===n||n!==i)&&this.push({name:e,buffer:t,start:n,end:i})}_transform(e,t,n){let i=0,s=this.index,{index:r,state:o,flags:a}=this,{lookbehind:l,boundary:h,boundaryChars:d}=this,c=h.length,u=c-1;this.bufferLength=e.length;let f=null,p=null,m=(e,t)=>{this[`${e}Mark`]="number"==typeof t?t:i},g=e=>{delete this[`${e}Mark`]},E=(t,n)=>{let s=`${t}Mark`;s in this&&(n?(this._handleCallback(t,e,this[s],i),g(t)):(this._handleCallback(t,e,this[s],e.length),m(t,0)))};for(i=0;i<this.bufferLength;i++)switch(f=e[i],o){case em.PARSER_UNINITIALIZED:n(this._endUnexpected());return;case em.START:r=0,o=em.START_BOUNDARY;case em.START_BOUNDARY:if(r===h.length-2){if(45===f)a|=eg.LAST_BOUNDARY;else if(13!==f){n(this._endUnexpected());return}r++;break}if(r-1==h.length-2){if(a&eg.LAST_BOUNDARY&&45===f)this._handleCallback("end"),o=em.END,a=0;else if(a&eg.LAST_BOUNDARY||10!==f){n(this._endUnexpected());return}else r=0,this._handleCallback("partBegin"),o=em.HEADER_FIELD_START;break}f!==h[r+2]&&(r=-2),f===h[r+2]&&r++;break;case em.HEADER_FIELD_START:o=em.HEADER_FIELD,m("headerField"),r=0;case em.HEADER_FIELD:if(13===f){g("headerField"),o=em.HEADERS_ALMOST_DONE;break}if(r++,45===f)break;if(58===f){if(1===r){n(this._endUnexpected());return}E("headerField",!0),o=em.HEADER_VALUE_START;break}if((p=32|f)<97||p>122){n(this._endUnexpected());return}break;case em.HEADER_VALUE_START:if(32===f)break;m("headerValue"),o=em.HEADER_VALUE;case em.HEADER_VALUE:13===f&&(E("headerValue",!0),this._handleCallback("headerEnd"),o=em.HEADER_VALUE_ALMOST_DONE);break;case em.HEADER_VALUE_ALMOST_DONE:if(10!==f){n(this._endUnexpected());return}o=em.HEADER_FIELD_START;break;case em.HEADERS_ALMOST_DONE:if(10!==f){n(this._endUnexpected());return}this._handleCallback("headersEnd"),o=em.PART_DATA_START;break;case em.PART_DATA_START:o=em.PART_DATA,m("partData");case em.PART_DATA:if(s=r,0===r){for(i+=u;i<this.bufferLength&&!(e[i]in d);)i+=c;i-=u,f=e[i]}if(r<h.length)h[r]===f?(0===r&&E("partData",!0),r++):r=0;else if(r===h.length)r++,13===f?a|=eg.PART_BOUNDARY:45===f?a|=eg.LAST_BOUNDARY:r=0;else if(r-1===h.length){if(a&eg.PART_BOUNDARY){if(r=0,10===f){a&=~eg.PART_BOUNDARY,this._handleCallback("partEnd"),this._handleCallback("partBegin"),o=em.HEADER_FIELD_START;break}}else a&eg.LAST_BOUNDARY&&45===f?(this._handleCallback("partEnd"),this._handleCallback("end"),o=em.END,a=0):r=0}r>0?l[r-1]=f:s>0&&(this._handleCallback("partData",l,0,s),s=0,m("partData"),i--);break;case em.END:break;default:n(this._endUnexpected());return}return E("headerField"),E("headerValue"),E("partData"),this.index=r,this.state=o,this.flags=a,n(),this.bufferLength}explain(){return`state = ${e_.stateToString(this.state)}`}}e_.stateToString=e=>{for(let t in em)if(em[t]===e)return t};let ey=Object.assign(e_,{STATES:eE});class eb extends ea.Transform{constructor(e={}){super({readableObjectMode:!0}),this.chunks=[],this.globalOptions={...e}}_transform(e,t,n){this.chunks.push(String(e)),n()}_flush(e){try{let e=JSON.parse(this.chunks.join(""));this.push(e)}catch(t){e(t);return}this.chunks=null,e()}}function ev(e,t){this.type="json";let n=new eb(this.options);n.on("data",e=>{this.fields=e}),n.once("end",()=>{this.ended=!0,this._maybeEnd()}),this._parser=n}class eO extends ea.Transform{constructor(e,t={}){super(),this.globalOptions={...t},this.incomingForm=e}_flush(e){this.incomingForm.ended=!0,this.incomingForm._maybeEnd(),e()}}let eA=function(e){e=e||16;var t="",n=0;return function(){if(!t||256===n){for(t="",n=(1+e)/2|0;n--;)t+=es[256*Math.random()|0];t=t.substring(n=0,e-2)}return t+es[n++]}}(25),eT={maxFields:1e3,maxFieldsSize:0x1400000,maxFiles:1/0,maxFileSize:0xc800000,maxTotalFileSize:void 0,minFileSize:1,allowEmptyFiles:!1,createDirsFromUploads:!1,keepExtensions:!1,encoding:"utf-8",hashAlgorithm:!1,uploadDir:H.tmpdir(),enabledPlugins:[eh,function(e,t){let n=this||e;return/urlencoded/i.test(n.headers["content-type"])&&eu.call(n,n,t),n},function(e,t){let n=this||e;if(/multipart/i.test(n.headers["content-type"])){let e=n.headers["content-type"].match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(e){var i;(i=e[1]||e[2],function(){let e,t,n;this.type="multipart";let s=new ey(this.options);s.initWithBoundary(i),s.on("data",async({name:i,buffer:r,start:o,end:a})=>{if("partBegin"===i)(n=new ea.Stream).readable=!0,n.headers={},n.name=null,n.originalFilename=null,n.mimetype=null,n.transferEncoding=this.options.encoding,n.transferBuffer="",e="",t="";else if("headerField"===i)e+=r.toString(this.options.encoding,o,a);else if("headerValue"===i)t+=r.toString(this.options.encoding,o,a);else if("headerEnd"===i){e=e.toLowerCase(),n.headers[e]=t;let i=t.match(/\bname=("([^"]*)"|([^\(\)<>@,;:\\"\/\[\]\?=\{\}\s\t/]+))/i);"content-disposition"===e?(i&&(n.name=i[2]||i[3]||""),n.originalFilename=this._getFileName(t)):"content-type"===e?n.mimetype=t:"content-transfer-encoding"===e&&(n.transferEncoding=t.toLowerCase()),e="",t=""}else if("headersEnd"===i){switch(n.transferEncoding){case"binary":case"7bit":case"8bit":case"utf-8":{let e=e=>{"partData"===e.name&&n.emit("data",e.buffer.slice(e.start,e.end))},t=i=>{"partEnd"===i.name&&(n.emit("end"),s.off("data",e),s.off("data",t))};s.on("data",e),s.on("data",t);break}case"base64":{let e=e=>{if("partData"===e.name){n.transferBuffer+=e.buffer.slice(e.start,e.end).toString("ascii");let t=4*parseInt(n.transferBuffer.length/4,10);n.emit("data",Buffer.from(n.transferBuffer.substring(0,t),"base64")),n.transferBuffer=n.transferBuffer.substring(t)}},t=i=>{"partEnd"===i.name&&(n.emit("data",Buffer.from(n.transferBuffer,"base64")),n.emit("end"),s.off("data",e),s.off("data",t))};s.on("data",e),s.on("data",t);break}default:return this._error(new ef("unknown transfer-encoding",1014,501))}this._parser.pause(),await this.onPart(n),this._parser.resume()}else"end"===i&&(this.ended=!0,this._maybeEnd())}),this._parser=s}).call(n,n,t)}else{let e=new ef("bad content-type header, no multipart boundary",1013,400);n._error(e)}}return n},function(e,t){let n=this||e;return/json/i.test(n.headers["content-type"])&&ev.call(n,n,t),n}],fileWriteStreamHandler:null,defaultInvalidName:"invalid-name",filter:e=>!0,filename:void 0};function ew(e,t){return Object.prototype.hasOwnProperty.call(e,t)}let eC=function(e){let t=Promise.resolve();return async function(...n){let i,s;let r=t;return t=new Promise(function(e){s=e}),await r,(i=e(...n)).then(s).catch(s),i}}(function(e){let t=B.dirname(e);return Y.mkdir(t,{recursive:!0})}),eS=e=>{let t=e.charCodeAt(0);return!(46===t||t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122)};class eN extends k.EventEmitter{constructor(e={}){super(),this.options={...eT,...e},this.options.maxTotalFileSize||(this.options.maxTotalFileSize=this.options.maxFileSize);let t=B.resolve(this.options.uploadDir||this.options.uploaddir||H.tmpdir());if(this.uploaddir=t,this.uploadDir=t,["error","headers","type","bytesExpected","bytesReceived","_parser","req"].forEach(e=>{this[e]=null}),this._setUpRename(),this._flushing=0,this._fieldsSize=0,this._totalFileSize=0,this._plugins=[],this.openedFiles=[],this.options.enabledPlugins=[].concat(this.options.enabledPlugins).filter(Boolean),0===this.options.enabledPlugins.length)throw new ef("expect at least 1 enabled builtin plugin, see options.enabledPlugins",1e3);this.options.enabledPlugins.forEach(e=>{this.use(e)}),this._setUpMaxFields(),this._setUpMaxFiles(),this.ended=void 0,this.type=void 0}use(e){if("function"!=typeof e)throw new ef(".use: expect `plugin` to be a function",1001);return this._plugins.push(e.bind(this)),this}pause(){try{this.req.pause()}catch(e){return this.ended||this._error(e),!1}return!0}resume(){try{this.req.resume()}catch(e){return this.ended||this._error(e),!1}return!0}async parse(e,t){let n;if(this.req=e,!t){let e,i;n=new Promise((t,n)=>{e=t,i=n}),t=(t,n,s)=>{t?i(t):e([n,s])}}let i=er(eo(t));this.fields={};let s={};return(this.on("field",(e,t)=>{"multipart"===this.type||"urlencoded"===this.type?ew(this.fields,e)?this.fields[e].push(t):this.fields[e]=[t]:this.fields[e]=t}),this.on("file",(e,t)=>{ew(s,e)?s[e].push(t):s[e]=[t]}),this.on("error",e=>{i(e,this.fields,s)}),this.on("end",()=>{i(null,this.fields,s)}),await this.writeHeaders(e.headers),e.on("error",e=>{this._error(e)}).on("aborted",()=>{this.emit("aborted"),this._error(new ef("Request aborted",1002))}).on("data",e=>{try{this.write(e)}catch(e){this._error(e)}}).on("end",()=>{!this.error&&this._parser&&this._parser.end()}),n)?n:this}async writeHeaders(e){if(this.headers=e,this._parseContentLength(),await this._parseContentType(),!this._parser){this._error(new ef("no parser found",1003,415));return}this._parser.once("error",e=>{this._error(e)})}write(e){return this.error?null:this._parser?(this.bytesReceived+=e.length,this.emit("progress",this.bytesReceived,this.bytesExpected),this._parser.write(e),this.bytesReceived):(this._error(new ef("uninitialized parser",1004)),null)}onPart(e){return this._handlePart(e)}async _handlePart(e){if(e.originalFilename&&"string"!=typeof e.originalFilename){this._error(new ef("the part.originalFilename should be string when it exists",1005));return}if(!e.mimetype){let t="",n=new V.StringDecoder(e.transferEncoding||this.options.encoding);e.on("data",e=>{if(this._fieldsSize+=e.length,this._fieldsSize>this.options.maxFieldsSize){this._error(new ef(`options.maxFieldsSize (${this.options.maxFieldsSize} bytes) exceeded, received ${this._fieldsSize} bytes of field data`,1006,413));return}t+=n.write(e)}),e.on("end",()=>{this.emit("field",e.name,t)});return}if(!this.options.filter(e))return;this._flushing+=1;let t=0,n=this._getNewName(e),i=this._joinDirectoryName(n),s=await this._newFile({newFilename:n,filepath:i,originalFilename:e.originalFilename,mimetype:e.mimetype});s.on("error",e=>{this._error(e)}),this.emit("fileBegin",e.name,s),s.open(),this.openedFiles.push(s),e.on("data",e=>{if(this._totalFileSize+=e.length,t+=e.length,this._totalFileSize>this.options.maxTotalFileSize){this._error(new ef(`options.maxTotalFileSize (${this.options.maxTotalFileSize} bytes) exceeded, received ${this._totalFileSize} bytes of file data`,1009,413));return}0!==e.length&&(this.pause(),s.write(e,()=>{this.resume()}))}),e.on("end",()=>{if(!this.options.allowEmptyFiles&&0===t){this._error(new ef("options.allowEmptyFiles is false, file size should be greater than 0",1010,400));return}if(t<this.options.minFileSize){this._error(new ef(`options.minFileSize (${this.options.minFileSize} bytes) inferior, received ${t} bytes of file data`,1008,400));return}if(t>this.options.maxFileSize){this._error(new ef(`options.maxFileSize (${this.options.maxFileSize} bytes), received ${t} bytes of file data`,1016,413));return}s.end(()=>{this._flushing-=1,this.emit("file",e.name,s),this._maybeEnd()})})}async _parseContentType(){if(0===this.bytesExpected){this._parser=new eO(this,this.options);return}if(!this.headers["content-type"]){this._error(new ef("bad content-type header, no content-type",1011,400));return}new eO(this,this.options),await Promise.all(this._plugins.map(async(e,t)=>{let n=null;try{n=await e(this,this.options)||this}catch(n){let e=new ef(`plugin on index ${t} failed with: ${n.message}`,1017,500);throw e.idx=t,e}Object.assign(this,n),this.emit("plugin",t,n)})),this.emit("pluginsResults",[])}_error(e,t="error"){this.error||this.ended||(this.req=null,this.error=e,this.emit(t,e),this.openedFiles.forEach(e=>{e.destroy()}))}_parseContentLength(){this.bytesReceived=0,this.headers["content-length"]?this.bytesExpected=parseInt(this.headers["content-length"],10):void 0===this.headers["transfer-encoding"]&&(this.bytesExpected=0),null!==this.bytesExpected&&this.emit("progress",this.bytesReceived,this.bytesExpected)}_newParser(){return new ey(this.options)}async _newFile({filepath:e,originalFilename:t,mimetype:n,newFilename:i}){if(this.options.fileWriteStreamHandler)return new $({newFilename:i,filepath:e,originalFilename:t,mimetype:n,createFileWriteStream:this.options.fileWriteStreamHandler,hashAlgorithm:this.options.hashAlgorithm});if(this.options.createDirsFromUploads)try{await eC(e)}catch(e){this._error(new ef("cannot create directory",1018,409))}return new j({newFilename:i,filepath:e,originalFilename:t,mimetype:n,hashAlgorithm:this.options.hashAlgorithm})}_getFileName(e){let t=e.match(/\bfilename=("(.*?)"|([^()<>{}[\]@,;:"?=\s/\t]+))($|;\s)/i);if(!t)return null;let n=t[2]||t[3]||"",i=n.substr(n.lastIndexOf("\\")+1);return(i=i.replace(/%22/g,'"')).replace(/&#([\d]{4});/g,(e,t)=>String.fromCharCode(t))}_getExtension(e){let t;if(!e)return"";let n=B.basename(e),i=n.indexOf("."),s=n.lastIndexOf("."),r=B.extname(n);i!==s&&(r=n.slice(i));let o=Array.from(r).findIndex(eS);return"."===(t=-1===o?r:r.substring(0,o))?"":t}_joinDirectoryName(e){let t=B.join(this.uploadDir,e);return t.startsWith(this.uploadDir)?t:B.join(this.uploadDir,this.options.defaultInvalidName)}_setUpRename(){"function"==typeof this.options.filename?this._getNewName=e=>{let t="",n=this.options.defaultInvalidName;return e.originalFilename&&({ext:t,name:n}=B.parse(e.originalFilename),!0!==this.options.keepExtensions&&(t="")),this.options.filename.call(this,n,t,e,this)}:this._getNewName=e=>{let t=eA();if(e&&this.options.keepExtensions){let n="string"==typeof e?e:e.originalFilename;return`${t}${this._getExtension(n)}`}return t}}_setUpMaxFields(){if(this.options.maxFields!==1/0){let e=0;this.on("field",()=>{(e+=1)>this.options.maxFields&&this._error(new ef(`options.maxFields (${this.options.maxFields}) exceeded`,1007,413))})}}_setUpMaxFiles(){if(this.options.maxFiles!==1/0){let e=0;this.on("fileBegin",()=>{(e+=1)>this.options.maxFiles&&this._error(new ef(`options.maxFiles (${this.options.maxFiles}) exceeded`,1015,413))})}}_maybeEnd(){!this.ended||this._flushing||this.error||(this.req=null,this.emit("end"))}}let{enabledPlugins:eD}=eT,ex=(...e)=>new eN(...e);var eR=n(9021),eI=n.n(eR),eF=n(3873),eP=n.n(eF),eL=n(5482);n.n(eL)().config();let eU={api:{bodyParser:!1}},eM=new L(process.env.GEMINI_API).getGenerativeModel({model:"gemini-2.0-flash",geminiConfig:{temperature:.9,topP:1,topK:1,maxOutputTokens:4096}}),ek=async(e,t)=>{if("POST"===e.method){let n=new ex.IncomingForm;n.uploadDir=eP().join(process.cwd(),"/public/uploads"),n.keepExtensions=!0,n.parse(e,async(e,n,i)=>{if(e)return t.status(500).json({error:"Error parsing the files"});let s=i.file.path;try{let e=`Describe the content of this image: ${s}`,n=(await eM.generateContent(e)).response.text();eI().unlinkSync(s),t.status(200).json({description:n})}catch(e){t.status(500).json({error:"Error generating description"})}})}else t.status(405).json({error:"Method not allowed"})}},1354:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var i=n(2740);(function(){var e=Error("Cannot find module '@/components/ui/toaster'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module '@/components/ui/sonner'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module '@/components/ui/tooltip'");throw e.code="MODULE_NOT_FOUND",e}();var s=n(9807),r=n(6722);!function(){var e=Error("Cannot find module '@/styles/globals.css'");throw e.code="MODULE_NOT_FOUND",e}();let o=new s.E;function a({children:e}){return(0,i.jsx)("html",{lang:"en",children:(0,i.jsx)("body",{children:(0,i.jsx)(r.QueryClientProvider,{client:o,children:(0,i.jsxs)(Object(function(){var e=Error("Cannot find module '@/components/ui/tooltip'");throw e.code="MODULE_NOT_FOUND",e}()),{children:[(0,i.jsx)(Object(function(){var e=Error("Cannot find module '@/components/ui/toaster'");throw e.code="MODULE_NOT_FOUND",e}()),{}),(0,i.jsx)(Object(function(){var e=Error("Cannot find module '@/components/ui/sonner'");throw e.code="MODULE_NOT_FOUND",e}()),{}),e]})})})})}},7336:e=>{"use strict";e.exports=JSON.parse('{"name":"dotenv","version":"16.4.7","description":"Loads environment variables from .env file","main":"lib/main.js","types":"lib/main.d.ts","exports":{".":{"types":"./lib/main.d.ts","require":"./lib/main.js","default":"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},"scripts":{"dts-check":"tsc --project tests/types/tsconfig.json","lint":"standard","pretest":"npm run lint && npm run dts-check","test":"tap run --allow-empty-coverage --disable-coverage --timeout=60000","test:coverage":"tap run --show-full-coverage --timeout=60000 --coverage-report=lcov","prerelease":"npm test","release":"standard-version"},"repository":{"type":"git","url":"git://github.com/motdotla/dotenv.git"},"funding":"https://dotenvx.com","keywords":["dotenv","env",".env","environment","variables","config","settings"],"readmeFilename":"README.md","license":"BSD-2-Clause","devDependencies":{"@types/node":"^18.11.3","decache":"^4.6.2","sinon":"^14.0.1","standard":"^17.0.0","standard-version":"^9.5.0","tap":"^19.2.0","typescript":"^4.8.4"},"engines":{"node":">=12"},"browser":{"fs":false}}')}};var t=require("../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),i=t.X(0,[178],()=>n(1039));module.exports=i})();